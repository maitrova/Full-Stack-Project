version: '3.8'

services:
  # üåê Public entry (Caddy) ‚Äî HTTP only for IP testing
  caddy:
    image: caddy:2
    container_name: caddy
    restart: unless-stopped
    ports:
      - "80:80"                         # Ivisit http://<PUBLIC_IP>
      - "443:443"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      - caddy_data:/data
    depends_on:
      - frontend
      - backend
    networks: [app-network]
  # üß± Mongo DB
  mongo:
    image: mongo:7
    container_name: mongo-service
    restart: always
    volumes:
      - /home/sai/mongo_data:/var/lib/mongo
    environment:
      MONGO_INITDB_ROOT_USERNAME: maitrova
      MONGO_INITDB_ROOT_PASSWORD: Saigollapalli@122
    ports:
      - "27017:27017"
    networks: [app-network] 
  backend:
    image: docker.io/maitrova/maitrova:backend
    container_name: backend-service
    restart: always
    expose:
      - "5000"                          # internal only; Caddy proxies
    environment:
      MONGOOSE_URL: mongodb://maitrova:Saigollapalli%40122@mongo:27017/appdb?authSource=admin
      APP_ENV: production
      PORT: 5000
      JWT_SECRET: "maitrova"
      MONGOOSE_PASSWORD: "Saigollapalli@122"
    depends_on:
      - mongo
    networks: [app-network]

  # üé® Frontend
  frontend:
    image: docker.io/maitrova/maitrova:frontend
    container_name: frontend-service
    restart: always
    expose:
      - "80"                          # internal only; Caddy proxies
    depends_on:
      - backend
    networks: [app-network]

networks:
  app-network:
    driver: bridge

volumes:
  caddy_data:
  mongo_data: